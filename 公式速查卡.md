# 双链区块链系统 - 公式速查卡

> 快速查阅版本，详细说明请参考《完整公式说明.md》

---

## 🔥 紧急度评估

### 核心公式
```
ED = E × e^(ω·θ)

其中: E = e^(-Tc/(Tr-Tu))
```

### 参数
- **Tc** = td - ta (期望延迟)
- **Tr** = ta (到达时间)
- **Tu** = tp (产生时间)
- **θ** = 已申请紧急交易数
- **ω** = 0.5 (影响权重)

### 速算表
| θ | ω=0.5 | 权重倍数 |
|---|-------|---------|
| 0 | e^0 | 1.00 |
| 1 | e^0.5 | 1.65 |
| 2 | e^1.0 | 2.72 |
| 3 | e^1.5 | 4.48 |

---

## 📊 信誉值计算

### 最终信誉值
```
R = T + γ·I
```
- **γ** = 0.2 (不确定度系数)

### 主观意见三元组
```
ω = (T, D, I)
T + D + I = 1
```

### 直接意见计算
```
I = 2/(2+N)
T = (1-I) × α/(α+β)
D = (1-I) × β/(α+β)

其中:
α = (1-θ) × PosEvents
β = θ × NegEvents
θ = μ/(1 + e^(Σ(δ×Neg)/Σδ))
```

### 直接权重
```
δ = ρ1·Fi + ρ2·TIM + ρ3·Sim
```

**默认值**:
- ρ1 = 0.4 (交互频率)
- ρ2 = 0.4 (时效性)
- ρ3 = 0.2 (轨迹相似度)

---

## ⚡ 紧急交易权重（加强版）

### 权重公式
```
普通交易: W = 1.0
紧急交易: W = 3.0 × (1 + 0.8 × ED)
上限: W ≤ 8.0
```

### 最终影响
```
δ_final = δ_base × W
```

### 权重速算表
| ED | W | 倍数 |
|----|---|------|
| 0.5 | 4.2 | 4.2× |
| 1.0 | 5.4 | 5.4× |
| 1.5 | 6.6 | 6.6× |
| 2.0 | 7.8 | 7.8× |
| 2.5+ | 8.0 | 8.0× |

---

## 🔀 间接意见与融合

### 折扣算子
```
T_new = T1 × T2
D_new = T1 × D2
I_new = D1 + I1 + T1×I2
```

### 共识算子
```
k = I_dir×I_ind + T_ind×I_dir + D_ind×I_dir

T = (T_dir×I_ind + T_ind×I_dir) / k
D = (D_dir×I_ind + D_ind×I_dir) / k
I = (I_dir×I_ind) / k
```

---

## 📐 常用子公式

### 交互频率
```
Fi = Nij / N_avg
```

### 时效性
```
TIM = η × Δt^(-ε)
```
- η = 1.0
- ε = 0.5

### 轨迹相似度
```
Sim = τ1·S_speed + τ2·S_dir + τ3·S_acc
```
- τ1 = 0.4
- τ2 = 0.4
- τ3 = 0.2

### 余弦相似度
```
Sim = (A·B) / (||A||×||B||)
```

---

## 🎯 典型值参考

### 紧急度范围
- 极高: 5.0 - 10.0
- 高: 2.0 - 5.0
- 中: 0.5 - 2.0
- 低: 0.1 - 0.5
- 极低: 0.0 - 0.1

### 信誉值范围
- 优秀: 0.8 - 1.0
- 良好: 0.6 - 0.8
- 中等: 0.4 - 0.6
- 较差: 0.2 - 0.4
- 恶意: 0.0 - 0.2

### 验证器阈值
- 推荐: 0.7
- 最低: 0.5

---

## 💻 实现位置

| 功能 | 文件 | 函数 |
|------|------|------|
| 紧急度计算 | emergency/transaction.go | CalculateUrgencyDegree |
| 交易权重 | reputation/reputation.go | CalculateTransactionWeight |
| 信誉值计算 | reputation/reputation.go | ComputeReputation |
| 直接意见 | reputation/reputation.go | computeDirectOpinions |
| 间接意见 | reputation/reputation.go | computeIndirectOpinions |
| 意见融合 | reputation/reputation.go | fuseOpinions |

---

## 🚀 快速计算示例

### 例1: 紧急度计算
```
给定: tp=0s, ta=0.1s, td=0.5s, θ=2, ω=0.5
步骤:
  Tc = 0.5 - 0.1 = 0.4
  E = e^(-0.4/0.1) = e^(-4) = 0.0183
  ED = 0.0183 × e^(0.5×2) = 0.0183 × 2.72 = 0.0498
```

### 例2: 权重计算
```
给定: ED=2.0, δ_base=0.8
步骤:
  W = 3.0 × (1 + 0.8 × 2.0) = 7.8
  δ_final = 0.8 × 7.8 = 6.24
```

### 例3: 信誉值
```
给定: T=0.65, I=0.25, γ=0.2
步骤:
  R = 0.65 + 0.2 × 0.25 = 0.70
```

---

## 📝 配置参数总表

| 类别 | 参数 | 符号 | 值 |
|------|------|------|---|
| **紧急度** | 影响权重 | ω | 0.5 |
| **信誉** | 不确定度系数 | γ | 0.2 |
| | Pearl因子 | μ | 1.5 |
| | 交互频率权重 | ρ1 | 0.4 |
| | 时效性权重 | ρ2 | 0.4 |
| | 相似度权重 | ρ3 | 0.2 |
| | 时效基础系数 | η | 1.0 |
| | 时间衰减指数 | ε | 0.5 |
| **轨迹** | 速度权重 | τ1 | 0.4 |
| | 方向权重 | τ2 | 0.4 |
| | 加速度权重 | τ3 | 0.2 |
| **权重** | 普通交易 | W_n | 1.0 |
| | 紧急基础 | W_e | 3.0 |
| | 影响系数 | α | 0.8 |
| | 最大倍数 | W_max | 8.0 |

---

**版本**: v1.2 | **日期**: 2024-10-24

